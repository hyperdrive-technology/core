# Appendix B

## Title

B Standard Function Blocks

## Introduction

- This appendix contains a complete overview of all the standard PLC function blocks described by means of examples in Chapter 2.For every standard function block of IEC 61131-3, the following information is given:
- -Graphical declaration -(Semantic) description -Specification of some function blocks in Structured Text (ST).
- In this book, the inputs and outputs of the standard FBs are given the names prescribed by the current version of IEC 61131-3. No allowance has been made for the fact that the possibility of calling FBs as "IL operators" can result in conflicts.
- These conflicts occur with the IL operators (see also Section 4.1) LD, R and S, which need to be distinguished from the FB inputs LD, R and S when checking for correct program syntax. Depending on the programming system, these three formal operands could, for example, be called LOAD, RESET and SET in future.

## Section B 1

### Title

B.1 Bistable Elements (Flip-Flops)

### Figure B 1

#### Description

Graphical declarations of the bistable function blocks SR and RS.

#### Caption

Figure B.1. Graphical declarations of the bistable function blocks SR and RS

### Example B 1

#### Code

FUNCTION_BLOCK SR (_ flip-flop set dominant _)
VAR_INPUT
S1 : BOOL;
R : BOOL;
END_VAR
VAR_OUTPUT
Q1 : BOOL;
END_VAR
Q1 := S1 OR ( NOT R AND Q1);
END_FUNCTION_BLOCK

FUNCTION_BLOCK RS (_ flip flop reset dominant _)
VAR_INPUT
S : BOOL;
R1 : BOOL;
END_VAR
VAR_OUTPUT
Q1 : BOOL;
END_VAR
Q1 := NOT R1 AND ( S OR Q1);
END_FUNCTION_BLOCK

#### Caption

Example B.1, Specification of the bistable function blocks SR and RS in ST

### Paragraph After Example

These two flip-flops implement dominant setting and resetting.

## Section B 2

### Title

B.2 Edge Detection

### Figure B 2

#### Description

Graphical declarations of the function blocks R_TRIG and F_TRIG.

#### Caption

Figure B.2. Graphical declarations of the function blocks R_TRIG and F_TRIG

### Example B 2

#### Code

FUNCTION_BLOCK R_TRIG (_ rising edge _)
VAR_INPUT
CLK : BOOL;
END_VAR
VAR_OUTPUT
Q : BOOL;
END_VAR
VAR RETAIN (_ example use of retentive variable _)
MEM : BOOL := 0; (_ initialise edge flag _)
END_VAR
Q := CLK AND NOT MEM; (_ recognise rising edge _)
MEM := CLK; (_ reset edge flag _)
END_FUNCTION_BLOCK

FUNCTION_BLOCK F_TRIG (_ falling edge _)
VAR_INPUT
CLK : BOOL;
END_VAR
VAR_OUTPUT
Q : BOOL;
END_VAR
VAR RETAIN
MEM : BOOL := 1; (_ initialise edge flag _)
END_VAR
Q := NOT CLK AND NOT MEM; (_ recognise falling edge _)
MEM := NOT CLK; (_ reset edge flag _)
END_FUNCTION_BLOCK

#### Caption

Example B.2. Specification of the function blocks R_TRIG and F_TRIG in ST

### Paragraph After Example

In the case of the function blocks R_TRIG and F_TRIG, it should be noted that they detect an "edge" on the first call if the input of R_TRIG is TRUE or the input of F_TRIG is FALSE.

## Section B 3

### Title

B.3 Counters

### Figure B 3

#### Description

Graphical declarations of the function blocks CTU, CTD and CTUD.

#### Caption

Figure B.3. Graphical declarations of the function blocks CTU, CTD and CTUD

### Example B 3

#### Code

FUNCTION_BLOCK CTU (_ up counter _)
VAR_INPUT
CU : BOOL R_EDGE; (_ CU with rising edge _)
R : BOOL;
PV : INT;
END_VAR
VAR_OUTPUT
Q : BOOL;
CV : INT;
END_VAR
IF R THEN (_ reset counter _)
CV := 0;
ELSIF CU AND ( CV < PV) THEN
CV := CV + 1; (_ count up _)
ENDIF;
Q := (CV >= PV); (_ limit reached _)
END_FUNCTION_BLOCK

FUNCTION_BLOCK CTD (_ down counter _)
VAR_INPUT
CD : BOOL R_EDGE; (_ CD with falling edge _)
LD : BOOL;
PV : INT;
END_VAR
VAR_OUTPUT
Q : BOOL;
CV : INT;
END_VAR
IF LD THEN (_ reset counter _)
CV := PV;
ELSIF CD AND ( CV > 0) THEN
CV := CV - 1; (_ count down _)
ENDIF;
Q := (CV <= 0); (_ zero reached _)
END_FUNCTION_BLOCK

#### Caption

Example B.3. Specification of the function blocks CTU and CTD in ST (continued on next page)

### Paragraph After Example B 3

When used as versions for DINT, LINT, UDINT, ULINT, the counters CTU and CTD are accordingly designated CTU_DINT etc. up to CTD_ULINT.

### Example B 4

#### Code

FUNCTION_BLOCK CTUD (_ up-down counter _)
VAR_INPUT
CU : BOOL R_EDGE; (_ CU with rising edge _)
CD : BOOL R_EDGE; (_ CD with falling edge _)
R : BOOL;
LD : BOOL;
PV : INT;
END_VAR
VAR_OUTPUT
QU : BOOL;
QD : BOOL;
CV : INT;
END_VAR
IF R THEN (_ reset counter (reset dominant) _)
CV := 0;
ELSIF LD THEN
CV := PV; (_ set to count value _)
ELSE
IF NOT (CU AND CD) THEN
IF CU AND ( CV < PV) THEN
CV := CV + 1; (_ count up _)
ELSIF CD AND ( CV > 0) THEN
CV := CV - 1; (_ count down _)
ENDIF;
ENDIF;
ENDIF;
QU := (CV >= PV); (_ limit reached _)
QD := (CV <= 0); (_ zero reached _)
END_FUNCTION_BLOCK

#### Caption

Example B.4. Specification of the function block CTUD in ST

## Section B 4

### Title

B.4 Timers

### Figure B 4

#### Description

Graphical declarations of the function blocks TON, TOF and TP.

#### Caption

Figure B.4. Graphical declarations of the function blocks TON, TOF and TP

### Paragraphs

- The timers TP, TON and TOF are specified here using timing diagrams.
- This time behaviour is only possible if the cycle time of the cyclic PLC program in which the timer is used is negligibly small in comparison with the duration PT if the timer is called only once in the cycle.
- The diagrams show the behaviour of outputs Q and ET depending on input IN. The time axis runs from left to right and is labelled "t". The Boolean variables IN and Q change between "0" and "1" and the time value ET increases as shown.

### Figure B 5

#### Description

Timing diagram for pulse timer TP depending on input IN.

#### Caption

Figure B.5. Timing diagram for pulse timer TP depending on input IN

### Paragraph After Figure B 5

The standard FB "TP" acts as a pulse generator which supplies a pulse of constant length at output Q when a rising edge is detected at input IN. The time that has elapsed so far can be read off at output ET at any time.
As can be seen from Figure B.5, timers of type TP are not "retriggerable". If the intervals between the input pulses at IN are shorter than the pre-set time period, the pulse duration still remains constant (see period [t2; t2+PT]). Timing therefore does not begin again with every rising edge at IN.

### Figure B 6

#### Description

Timing diagram for on-delay timer TON depending on input IN.

#### Caption

Figure B.6. Timing diagram for on-delay timer TON depending on input IN

### Paragraph After Figure B 6

The on-delay timer TON supplies the input value IN at Q with a time delay when a rising edge is detected at IN. If input IN is "1" only for a short pulse (shorter than PT), the timer is not started for this edge.
The elapsed time can be read off at output ET.

### Figure B 7

#### Description

Timing diagram for off-delay timer TOF depending on input IN.

#### Caption

Figure B.7. Timing diagram for off-delay timer TOF depending on input IN

### Paragraphs After Figure B 7

- The off-delay timer performs the inverse function to TON i.e. it delays a falling edge in the same way as TON delays a rising one.
- The behaviour of the timer TOF if PT is modified during timer operation is implementation-dependent.
